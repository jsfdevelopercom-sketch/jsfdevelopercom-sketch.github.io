<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>APACHE II Bedside Entry</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@600;700&display=swap" rel="stylesheet">
<style>
  :root{
    color-scheme: light;
    --surface: rgba(255,255,255,0.9);
    --surface-strong: rgba(255,255,255,0.98);
    --outline: rgba(148,163,184,0.4);
    --muted:#475569; --text:#0f172a;
    --accent:#2563eb; --accent-dark:#1d4ed8;
    --bg-gradient:
      radial-gradient(circle at 5% 0%, rgba(59,130,246,.22), transparent 45%),
      radial-gradient(circle at 95% 0%, rgba(14,165,233,.18), transparent 40%),
      linear-gradient(180deg,#f1f5f9 0%,#e2e8f0 55%,#f8fafc 100%);
    --shadow: 0 30px 60px -25px rgba(15,23,42,.35);
    --shadow-soft: 0 20px 50px -30px rgba(15,23,42,.35);
    --radius-lg: 26px; --radius-md:18px; --radius-sm:12px;
    --max-width:1260px;
    font-synthesis:none; text-rendering:optimizeLegibility;
  }
  *,*::before,*::after{box-sizing:border-box}
  body{margin:0;min-height:100vh;font-family:"Inter",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;color:var(--text);background:var(--bg-gradient);display:flex;flex-direction:column}
  a{color:inherit}

  .masthead{position:relative;padding:clamp(24px,5vw,42px) clamp(18px,7vw,64px) clamp(28px,6vw,52px);display:flex;flex-direction:column;gap:clamp(18px,4vw,36px);overflow:hidden}
  .masthead::before{content:"";position:absolute;inset:12% auto -20% 50%;width:clamp(240px,40vw,520px);height:clamp(240px,45vw,560px);background:radial-gradient(circle, rgba(37,99,235,.45), transparent 70%);transform:translateX(-50%) rotate(18deg);filter:blur(42px);opacity:.6}
  .masthead__inner{position:relative;z-index:1;max-width:var(--max-width);margin:0 auto;display:flex;flex-direction:column;gap:clamp(18px,4vw,36px)}
  .topline{display:flex;align-items:center;justify-content:space-between;gap:18px}
  .brand{display:flex;align-items:center;gap:16px}
  .brand__mark{width:48px;height:48px;border-radius:16px;background:linear-gradient(135deg, rgba(37,99,235,.92), rgba(59,130,246,.7));display:grid;place-items:center;color:#fff;font-family:"Plus Jakarta Sans","Inter",sans-serif;font-weight:700;font-size:20px;letter-spacing:.04em;box-shadow:var(--shadow-soft)}
  .brand__copy h1{margin:0;font-family:"Plus Jakarta Sans","Inter",sans-serif;font-size:clamp(30px,5vw,44px);font-weight:700;letter-spacing:-.02em}
  .brand__copy p{margin:6px 0 0;max-width:520px;color:var(--muted);font-size:clamp(15px,2.5vw,18px);line-height:1.6}
  .dev-bubble{width:42px;height:42px;border-radius:50%;border:1px solid rgba(255,255,255,.7);background:rgba(15,23,42,.75);color:#e2e8f0;display:grid;place-items:center;cursor:pointer;box-shadow:0 16px 40px -20px rgba(15,23,42,.65);backdrop-filter:blur(12px);transition:transform .2s ease}
  .dev-bubble:hover{transform:translateY(-2px)}

  .mode-switcher{display:grid;gap:10px;align-items:start}
  .mode-pills{display:grid;grid-template-columns:1fr;gap:12px}
  .mode{position:relative;border-radius:var(--radius-md);border:1px solid transparent;padding:14px 18px;background:rgba(255,255,255,.65);color:var(--muted);font-weight:600;text-align:left;cursor:default}
  .mode.active{background:linear-gradient(135deg,#2563eb,#14a3e9);color:#fff;box-shadow:0 18px 42px -18px rgba(37,99,235,.6)}
  .mode-hint{font-size:14px;color:var(--muted)}

  .patient-mini{display:flex;flex-wrap:wrap;gap:8px;align-items:center;color:var(--muted)}
  .mini-field{display:flex;align-items:center;gap:8px;padding:10px 16px;border-radius:999px;border:1px solid rgba(148,163,184,.4);background:rgba(255,255,255,.75);box-shadow:0 12px 28px -22px rgba(15,23,42,.45)}
  .mini-field span{font-size:16px}
  .mini-field input{border:0;background:transparent;font-size:14px;outline:none;min-width:110px}

  .workspace-wrapper{flex:1;padding:0 clamp(18px,7vw,64px) clamp(180px,12vw,220px)}
  .workspace{position:relative;z-index:1;max-width:var(--max-width);margin:0 auto;display:grid;gap:clamp(20px,4vw,36px)}
  .cards-flow{display:grid;gap:clamp(18px,3vw,28px)}
  .panel{background:var(--surface);border-radius:var(--radius-lg);border:1px solid var(--outline);padding:clamp(18px,3vw,28px);box-shadow:var(--shadow-soft);backdrop-filter:blur(14px);display:grid;gap:clamp(16px,2.5vw,26px)}
  .panel header{display:grid;gap:6px}
  .panel h2{margin:0;font-size:clamp(18px,2.7vw,22px);font-weight:700;letter-spacing:-.01em}
  .panel .hint{margin:0;color:var(--muted);font-size:13px;line-height:1.5}

  label{font-weight:600;font-size:14px;color:#1e293b;display:block;margin-bottom:6px}
  .input,select,textarea{width:100%;padding:12px 14px;border-radius:var(--radius-sm);border:1px solid rgba(148,163,184,.5);background:rgba(248,250,252,.92);font-size:15px;transition:border .2s ease,box-shadow .2s ease,background .2s ease}
  .input:focus,select:focus,textarea:focus{outline:none;border-color:rgba(37,99,235,.6);box-shadow:0 0 0 4px rgba(37,99,235,.15);background:#fff}
  input[type=number]::-webkit-outer-spin-button,input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}

  .grid-2,.grid-3{display:grid;gap:18px}
  .grid-2{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
  .grid-3{grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}

  .chip-row{display:flex;flex-wrap:wrap;gap:12px}
  .chip{display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border-radius:var(--radius-md);background:rgba(148,163,184,.14);border:1px solid transparent;font-weight:600;cursor:pointer;color:var(--muted);transition:all .2s ease}
  .chip input[type=radio]{accent-color:var(--accent)}
  .chip:hover{background:rgba(37,99,235,.1)}

  .tab-bar{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:4px}
  .tab{border:1px solid rgba(148,163,184,.4);background:rgba(255,255,255,.7);padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer}
  .tab.active{background:linear-gradient(135deg,#2563eb,#14a3e9);color:#fff;border-color:transparent}
  .tab-panel{display:none}
  .tab-panel.active{display:block}

  .action-dock{position:fixed;left:0;right:0;bottom:0;padding:18px clamp(18px,7vw,64px) max(env(safe-area-inset-bottom,24px),28px);background:rgba(255,255,255,.96);border-top:1px solid rgba(148,163,184,.35);box-shadow:0 -18px 42px -24px rgba(15,23,42,.45);backdrop-filter:blur(16px)}
  .action-dock__inner{max-width:var(--max-width);margin:0 auto;display:grid;gap:12px}
  .btn{border-radius:var(--radius-md);border:1px solid transparent;padding:16px;font-weight:600;font-size:16px;cursor:pointer;transition:transform .18s ease,box-shadow .18s ease,background .18s ease}
  .btn.primary{background:linear-gradient(135deg,#2563eb,#1e40af);color:#fff;box-shadow:0 20px 40px -18px rgba(37,99,235,.55)}
  .btn.primary:hover:not([disabled]){transform:translateY(-1px)}
  .btn.secondary{background:rgba(37,99,235,.08);color:var(--accent-dark);border:1px solid rgba(37,99,235,.18)}
  .btn.ghost{background:transparent;border:1px solid rgba(148,163,184,.35);color:var(--muted)}
  .btn[disabled]{opacity:.6;cursor:progress}

  .toast{position:fixed;right:clamp(18px,5vw,64px);bottom:clamp(120px,12vw,180px);min-width:min(360px,calc(100vw - 48px));background:#fff;border-radius:var(--radius-md);border-left:4px solid #16a34a;padding:16px 20px;box-shadow:var(--shadow);font-weight:600;color:var(--text);display:none;z-index:90}
  .toast.err{border-left-color:#dc2626;color:#dc2626}

  /* Dev modal */
  .dev-panel,.dev-backdrop{position:fixed;inset:0;z-index:130}
  .dev-backdrop{background:rgba(15,23,42,.5);backdrop-filter:blur(6px);opacity:0;pointer-events:none;transition:opacity .25s ease}
  .dev-backdrop[data-visible="true"]{opacity:1;pointer-events:auto}
  .dev-panel{display:grid;place-items:center;pointer-events:none;opacity:0;visibility:hidden;transition:opacity .25s ease,visibility .25s ease}
  .dev-panel[aria-hidden="false"]{opacity:1;visibility:visible;pointer-events:auto}
  .dev-sheet{
    width:min(560px,calc(100vw - 48px));
    background:#0f172a;color:#f8fafc;border-radius:var(--radius-lg);
    border:1px solid rgba(148,163,184,.35);box-shadow:0 30px 80px -30px rgba(15,23,42,.8);
    padding:26px;display:grid;gap:18px;pointer-events:auto;
    max-height:min(80vh, 720px);
    overflow-y:auto;
  }
  .dev-sheet h3{margin:0;font-size:20px;font-weight:600}
  .dev-sheet .close{justify-self:end;border:0;background:rgba(148,163,184,.15);color:#e2e8f0;border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
  .dev-sheet label{color:#cbd5f5}
  .dev-sheet .input{background:rgba(15,23,42,.75);color:#f8fafc;border:1px solid rgba(148,163,184,.4)}
  .dev-tip{font-size:13px;color:rgba(226,232,240,.7)}

  /* Results card */
  .results-card{
    display:none;
    background:var(--surface-strong);
    border:1px solid rgba(148,163,184,.35);
    border-radius:18px;
    box-shadow:var(--shadow);
    padding:16px 18px;
  }
  .results-card[data-visible="true"]{display:block}
  .results-title{margin:0 0 8px 0;font-weight:700}
  .results-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .metric{padding:12px 14px;border-radius:12px;background:rgba(148,163,184,.12);font-weight:700}
  .metric small{display:block;font-weight:600;color:var(--muted)}

  body.desktop .workspace{grid-template-columns:1fr 360px;align-items:start}
  body.desktop .cards-flow{grid-template-columns:repeat(2,minmax(0,1fr))}
  body.desktop .action-dock__inner{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:899px){body.desktop .workspace{grid-template-columns:1fr}}
  @media (prefers-reduced-motion: reduce){
    *,*::before,*::after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}
  }
</style>
</head>
<body>
  <header class="masthead" role="banner">
    <div class="masthead__inner">
      <div class="topline">
        <div class="brand">
          <div class="brand__mark" aria-hidden="true">AI</div>
          <div class="brand__copy">
            <h1>APACHE II bedside console</h1>
            <p>Direct to Google Sheets. One shared sheet per month. All doctors, one source of truth.</p>
          </div>
        </div>
        <button id="devToggle" class="dev-bubble" aria-label="Developer settings" aria-haspopup="dialog" aria-expanded="false">‚öôÔ∏è</button>
      </div>

      <div class="mode-switcher" aria-label="Submission mode">
        <div class="mode-pills" role="group">
          <button id="modeOnline" type="button" class="mode active" disabled>Online (Google Sheets)</button>
        </div>
        <div id="modeHint" class="mode-hint">Data goes straight to the shared Google Sheet (one tab per month). ‚ÄúDownload current month‚Äù opens the CSV in a new tab.</div>
        <div class="patient-mini" aria-label="Quick patient entry">
          <div class="mini-field"><span>üë§</span><input id="patientNameMini" type="text" placeholder="Patient name" autocomplete="off"></div>
          <div class="mini-field"><span>üÜî</span><input id="uhidMini" type="text" placeholder="UHID" autocomplete="off"></div>
        </div>
      </div>
    </div>
  </header>

  <div class="workspace-wrapper">
    <main class="workspace" id="formContent">
      <div class="cards-flow">
        <!-- Patient -->
        <section class="panel" data-span="full" aria-labelledby="patient-h">
          <header>
            <h2 id="patient-h">Patient</h2>
            <p class="hint">Identifiers sync between compact and expanded entry areas automatically.</p>
          </header>
          <div class="grid-2">
            <div>
              <label for="patientName">Patient Name*</label>
              <input id="patientName" class="input" type="text" required placeholder="e.g., Jane Doe" autocomplete="off">
            </div>
            <div>
              <label for="uhid">UHID*</label>
              <input id="uhid" class="input" type="text" required placeholder="Unit health ID" autocomplete="off">
            </div>
          </div>
        </section>

        <!-- Demographics -->
        <section class="panel" aria-labelledby="demo-h">
          <header>
            <h2 id="demo-h">Demographics & Admission</h2>
            <p class="hint">These fields are required to build the monthly sheet row.</p>
          </header>
          <div class="grid-3">
            <div>
              <label for="age">Age (years)*</label>
              <input id="age" class="input" type="number" min="0" max="120" step="1" required placeholder="Years">
            </div>
            <div>
              <label for="sex">Sex*</label>
              <select id="sex" class="input" required>
                <option value="" selected disabled>Select</option>
                <option>Male</option>
                <option>Female</option>
                <option>Other</option>
              </select>
            </div>
            <div>
              <label for="admitDate">Admission Date*</label>
              <input id="admitDate" class="input" type="date" required>
            </div>
          </div>
          <div>
            <label for="diagnosis">Diagnosis*</label>
            <input id="diagnosis" class="input" type="text" required placeholder="Primary diagnosis at ICU admission">
          </div>
          <div class="grid-2">
            <div>
              <label for="gcs">GCS (3‚Äì15)</label>
              <input id="gcs" class="input" type="number" min="3" max="15" step="1" placeholder="e.g., 12">
            </div>
          </div>
        </section>

        <!-- Chronic -->
        <section class="panel" aria-labelledby="chronic-h">
          <header>
            <h2 id="chronic-h">Chronic health</h2>
            <p class="hint">Reveal surgical pathways when significant organ failure is present.</p>
          </header>
          <div class="chip-row" id="chronicGrp">
            <label class="chip"><input type="radio" name="chronic" value="No" checked> No</label>
            <label class="chip"><input type="radio" name="chronic" value="Yes"> Yes ‚Äì severe organ failure / immunocompromise</label>
          </div>
          <div id="surgTypeWrap" class="grid-2" style="display:none">
            <div>
              <label>Type of surgery (if chronic = Yes)</label>
              <div class="chip-row">
                <label class="chip"><input type="radio" name="surgtype" value="Emergency" checked> Emergency</label>
                <label class="chip"><input type="radio" name="surgtype" value="Elective"> Elective</label>
                <label class="chip"><input type="radio" name="surgtype" value="Nonoperative"> Non-operative</label>
              </div>
            </div>
          </div>
        </section>

        <!-- Inputs -->
        <section class="panel" data-span="full" aria-labelledby="inputs-h">
          <header>
            <h2 id="inputs-h">Clinical inputs</h2>
            <p class="hint">Segment vitals, oxygenation and labs with quick swipe tabs.</p>
          </header>
          <div class="tab-bar" role="tablist">
            <button class="tab active" type="button" data-tab="vitals">Vitals</button>
            <button class="tab" type="button" data-tab="oxygen">Oxygenation</button>
            <button class="tab" type="button" data-tab="labs">Labs</button>
          </div>

          <div id="tab-vitals" class="tab-panel active" role="tabpanel">
            <div class="grid-3">
              <div>
                <label for="tempF">Temperature (¬∞F)</label>
                <input id="tempF" class="input" type="number" step="0.1">
              </div>
              <div>
                <label for="map">Mean Arterial Pressure (mmHg)</label>
                <input id="map" class="input" type="number" step="1">
              </div>
              <div>
                <label for="hr">Heart Rate (bpm)</label>
                <input id="hr" class="input" type="number" step="1">
              </div>
            </div>
            <div class="grid-2">
              <div>
                <label for="rr">Respiratory Rate (breaths/min)</label>
                <input id="rr" class="input" type="number" step="1">
              </div>
            </div>
          </div>

          <div id="tab-oxygen" class="tab-panel" role="tabpanel">
            <div>
              <label>FiO‚ÇÇ category*</label>
              <div class="chip-row" id="fio2Grp">
                <label class="chip"><input type="radio" name="fio2" value="<50%" checked> &lt; 50% (or non-intubated)</label>
                <label class="chip"><input type="radio" name="fio2" value=">=50%"> ‚â• 50%</label>
              </div>
            </div>

            <div id="po2Wrap">
              <label for="pao2">PaO‚ÇÇ (mmHg)</label>
              <input id="pao2" class="input" type="number" step="1" placeholder="e.g., 80" autocomplete="off">
              <p class="hint">If FiO‚ÇÇ &lt; 50% ‚Üí provide PaO‚ÇÇ.</p>
            </div>

            <div id="aagradWrap" style="display:none">
              <label for="aagrad">A‚Äìa gradient (mmHg)</label>
              <input id="aagrad" class="input" type="number" step="1" placeholder="e.g., 220" autocomplete="off">
              <p class="hint">If FiO‚ÇÇ ‚â• 50% ‚Üí provide A‚Äìa gradient.</p>
            </div>
          </div>

          <div id="tab-labs" class="tab-panel" role="tabpanel">
            <div class="grid-3">
              <div>
                <label for="ph">pH (arterial)</label>
                <input id="ph" class="input" type="number" step="0.01" min="6.8" max="7.8">
              </div>
              <div>
                <label for="hco3">HCO‚ÇÉ‚Åª (mEq/L) <span class="hint">(use if pH unavailable)</span></label>
                <input id="hco3" class="input" type="number" step="0.1">
              </div>
              <div>
                <label for="na">Na‚Å∫ (mEq/L)</label>
                <input id="na" class="input" type="number" step="1">
              </div>
            </div>
            <div class="grid-3">
              <div>
                <label for="k">K‚Å∫ (mEq/L)</label>
                <input id="k" class="input" type="number" step="0.1">
              </div>
              <div>
                <label for="cr">Creatinine (mg/dL)</label>
                <input id="cr" class="input" type="number" step="0.1">
              </div>
              <div>
