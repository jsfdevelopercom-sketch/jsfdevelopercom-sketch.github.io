<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>APACHE II Bedside Entry · Mobile</title>
<style>
  :root{
    --bg:#f7fafc; --panel:#fff; --line:#e2e8f0; --text:#0f172a; --muted:#475569;
    --acc:#2563eb; --acc-hover:#1d4ed8; --ok:#16a34a; --err:#dc2626;
    --radius:14px; --shadow:0 8px 20px rgba(15,23,42,.06);
  }
  *{box-sizing:border-box; min-width:0}
  html,body{height:100%; max-width:100%; overflow-x:hidden}
  body{margin:0; background:var(--bg); color:var(--text);
       font:16px/1.55 "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial;
       padding-bottom:96px}

  .wrap{max-width:720px; margin:0 auto; padding:14px 14px 120px}

  .topbar{position:sticky; top:0; z-index:10; background:#ffffffcc; backdrop-filter:blur(8px); border-bottom:1px solid var(--line)}
  .topbar-inner{display:grid; grid-template-columns:1fr; gap:4px; padding:10px 14px}
  .title h1{margin:0; font-size:20px; font-weight:800}
  .title .sub{color:var(--muted); font-size:12px}

  .patient-mini{display:none}
  body.fold6 .patient-mini{display:flex !important; gap:8px}
  .mini-field{display:flex; gap:6px; align-items:center; padding:8px 10px; border:1px solid var(--line); border-radius:999px; background:#f1f5f9}
  .mini-field input{border:0; outline:none; background:transparent; width:180px}

  .card{background:var(--panel); border:1px solid var(--line); border-radius:var(--radius); padding:14px; margin:12px 0; box-shadow:var(--shadow)}
  .card h2{font-size:16px; margin:0 0 8px 0}
  .hint{color:var(--muted); font-size:12px}

  .grid2,.grid3{display:grid; grid-template-columns:1fr; gap:10px}
  body.fold6 .grid2{grid-template-columns:1fr 1fr}
  body.fold6 .grid3{grid-template-columns:1fr 1fr 1fr}

  label{display:block; font-size:14px; color:#1f2a3a; margin:8px 0 6px}
  .ipt, select{width:100%; padding:12px; border:1px solid var(--line); border-radius:12px; background:#f8fafc; color:var(--text); outline:none}
  .ipt:focus{border-color:#cbd5e1; box-shadow:0 0 0 4px rgba(37,99,235,.12)}
  input[type=number]::-webkit-outer-spin-button,input[type=number]::-webkit-inner-spin-button{appearance:none;margin:0}

  .radio-row{display:flex; flex-wrap:wrap; gap:8px}
  .chip-radio{padding:10px 12px; border:1px solid var(--line); border-radius:12px; background:#f1f5f9; display:flex; align-items:center; gap:8px; cursor:pointer}
  .chip-radio input{accent-color:var(--acc)}

  .tabs{display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-bottom:8px}
  .tab{padding:10px; text-align:center; border:1px solid var(--line); border-radius:12px; background:#f1f5f9; cursor:pointer}
  .tab.active{background:var(--acc); color:#fff; border-color:var(--acc)}
  .tab-panel{display:none}
  .tab-panel.active{display:block}

  .modewrap{display:flex; gap:8px; margin-top:6px}
  .mode{flex:1; text-align:center; padding:10px; border:1px solid var(--line); border-radius:12px; background:#eef2ff; cursor:pointer; font-weight:700; color:#334155}
  .mode.active{background:var(--acc); color:#fff; border-color:var(--acc)}

  .dock{position:fixed; left:0; right:0; bottom:0; background:#fff; border-top:1px solid var(--line); padding:10px 14px; box-shadow:0 -6px 16px rgba(15,23,42,.06)}
  .dock-inner{max-width:720px; margin:0 auto; display:grid; grid-template-columns:1fr; gap:10px}
  body.fold6 .dock-inner{grid-template-columns:1fr 1fr}
  .btn{padding:14px; border-radius:12px; font-weight:700; border:1px solid var(--line); background:#f1f5f9; cursor:pointer}
  .btn.primary{background:var(--acc); color:#fff; border-color:var(--acc)}
  .btn.primary:hover{background:var(--acc-hover)}
  .btn.ghost{background:#fff}

  .toast{position:fixed; left:50%; transform:translateX(-50%); bottom:88px; background:#fff; border:1px solid var(--line); border-left:4px solid var(--ok); padding:12px 14px; border-radius:12px; box-shadow:var(--shadow); display:none; max-width:90%}
  .toast.err{border-left-color:var(--err)}

  .collapser{display:flex; justify-content:space-between; align-items:center; gap:10px; padding:10px 12px; border:1px dashed var(--line); border-radius:12px; background:#f8fafc}
  .devwrap{display:none; margin-top:10px}
  .preview{white-space:pre-wrap; background:#f1f5f9; border:1px solid var(--line); border-radius:12px; padding:12px; font-family:ui-monospace, SFMono-Regular, Menlo, monospace; font-size:13px}
  .link{color:var(--acc); text-decoration:underline; cursor:pointer}
</style>
</head>
<body>
  <div class="topbar"><div class="topbar-inner"><div class="title">
    <h1>APACHE II · Bedside Entry</h1>
    <div class="sub">Mobile-friendly ICU data capture</div>
  </div></div></div>

  <div class="wrap">
    <section class="card"><h2>Mode</h2>
      <div class="modewrap">
        <button id="modeOnline"  class="mode active" type="button">Online (Google Sheets)</button>
        <button id="modeDesktop" class="mode" type="button">Desktop (Hospital PC)</button>
      </div>
      <div class="hint" id="modeHint" style="margin-top:6px">Data goes straight to secure Google Sheets.</div>
    </section>

    <!-- Patient fields etc… (kept same as before) -->
    <!-- ... -->
  </div>

  <div class="dock"><div class="dock-inner" id="dockBtns">
    <button id="btnSubmit" class="btn primary" type="button">Submit</button>
    <button id="btnPreview" class="btn" type="button">Preview</button>
    <button id="btnDownload" class="btn ghost" type="button" style="display:none">Download current month</button>
  </div></div>

  <div id="toast" class="toast"></div>

<script>
(function(){
  const ua=(navigator.userAgent||"").toUpperCase();
  if (ua.includes("SM-F956") || ua.includes("Z FOLD 6") || ua.includes("Z FOLD6"))
    document.body.classList.add('fold6');
})();

const API_BASE = "https://apache-bridge-server-production.up.railway.app";
const SERVER_HTTP_URL = API_BASE + "/api/submit";
const SERVER_WS_URL   = API_BASE + "/ws/mobile";

/* Hardcoded Google Sheets Webhook + Secret */
let ONLINE_WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbwnmv8Qgt38LeeMgYQfh9Or83i-woNkz-gFIgIFjNJoKw_YF2rpVxh9V6syRoHEEw8/exec";
let ONLINE_SECRET      = "SUPER_STRONG_SHARED_TOKEN";

/* Utility functions omitted for brevity, same as before… */

/* Mode toggle */
let MODE = 'online';
function setMode(m){
  MODE=m;
  document.getElementById('modeOnline').classList.toggle('active', m==='online');
  document.getElementById('modeDesktop').classList.toggle('active', m==='desktop');
  document.getElementById('btnDownload').style.display=(m==='online')?'block':'none';
}
setMode('online');

/* Post Online */
async function postOnline(payload){
  payload.authToken = ONLINE_SECRET;
  const res = await fetch(ONLINE_WEBHOOK_URL, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(payload)
  });
  if(!res.ok){throw new Error("Google Sheets webhook error "+res.status);}
  return res.json().catch(()=> ({}));
}

/* Post Desktop (unchanged) */
async function postDesktop(payload){
  const res = await fetch(SERVER_HTTP_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
  if(!res.ok){throw new Error("Server error "+res.status);}
  return res.json().catch(()=> ({}));
}

/* Button handlers (same as before, but uses MODE to pick online/desktop) */
/* ... */
</script>
</body>
</html>
